<div class="well">

    <ul class="nav nav-tabs" id="lesson_tab">
        <li class="active"><a href="#home" data-toggle="tab">{{ 'General'|trans }}</a></li>
        <li><a href="#texts" data-toggle="tab">{{ 'Texts'|trans }}</a></li>
        <li><a href="#urls" data-toggle="tab">{{ 'Urls'|trans }}</a></li>
        <li><a href="#slideshares" data-toggle="tab">{{ 'Slideshare'|trans }}</a></li>
        <li><a href="#tasks" data-toggle="tab">{{ 'Tasks'|trans }}</a></li>
    </ul>

    <div class="tab-content">

        <div class="tab-pane active" id="home">
            {{ form_errors(form) }}

            {{ form_row(form.course) }}
            {{ form_row(form.title) }}
        </div>
        <div class="tab-pane" id="texts">
            {% for content in form.text_contents %}
                <div class="form-content-text">
                    <a class="btn btn-danger pull-right delete" href="#">{{ 'Delete'|trans }}</a>
                    {{ form_row(content.title) }}
                    {{ form_row(content.description) }}
                    {{ form_row(content.text) }}
                    {{ form_rest(content) }}
                    <hr>
                </div>
            {% endfor %}

            {% if not form.text_contents|length %}
                {% do  form.text_contents.setRendered() %}
            {% endif %}
            <a data-form-template="{{ form_widget(form.text_contents.vars.prototype)|e }}" class="btn add-form-text" href="#">{{ 'Add'|trans }}</a>
        </div>

        <div class="tab-pane" id="urls">
            {% for content in form.url_contents %}
                <div class="form-content-url">
                    <a class="btn btn-danger pull-right delete" href="#">{{ 'Delete'|trans }}</a>
                    {{ form_row(content.title) }}
                    {{ form_row(content.url) }}
                    {{ form_row(content.description) }}
                    {{ form_rest(content) }}
                    <hr/>
                </div>
            {% endfor %}

            {% if not form.url_contents|length %}
                {% do  form.url_contents.setRendered() %}
            {% endif %}
            <a data-form-template="{{ form_widget(form.url_contents.vars.prototype)|e }}" class="btn add-form-url" href="#">{{ 'Add'|trans }}</a>
        </div>

        <div class="tab-pane" id="slideshares">
            {% for content in form.slideshare_contents %}
                <div class="form-content-slideshare">
                    <a class="btn btn-danger pull-right delete" href="#">{{ 'Delete'|trans }}</a>
                    {{ form_row(content.title) }}
                    {{ form_row(content.url) }}
                    {{ form_row(content.description) }}
                    {{ form_rest(content) }}
                </div>
                <hr/>
            {% endfor %}

            {% if not form.slideshare_contents|length %}
                {% do  form.slideshare_contents.setRendered() %}
            {% endif %}

            <a data-form-template="{{ form_widget(form.slideshare_contents.vars.prototype)|e }}" class="btn add-form-slideshare" href="#">{{ 'Add'|trans }}</a>
        </div>

        <div class="tab-pane" id="tasks">
            {% for content in form.tasks %}
                <div class="form-content-task">
                    <div class="btn-group pull-right">
                        <a class="btn btn-info i-switcher" href="#" data-target="#task-{{ loop.index }}">{{ 'Expand'|trans }}</a>
                        <a class="btn btn-danger delete" href="#">{{ 'Delete'|trans }}</a>
                    </div>


                    <div><strong>{{ content.title.vars.value }}</strong></div>
                    <div class="hide" id="task-{{ loop.index }}">
                        {{ form_row(content.title) }}
                        {{ form_row(content.text) }}
                        {{ form_row(content.solution) }}
                        {{ form_rest(content) }}
                    </div>

                </div>
                <hr/>
            {% endfor %}

            {% if not form.tasks|length %}
                {% do  form.tasks.setRendered() %}
            {% endif %}
            <a data-form-template="{{ form_widget(form.tasks.vars.prototype)|e }}" class="btn add-form-task" href="#">{{ 'Add'|trans }}</a>
        </div>

        {{ form_rest(form) }}

        <script type="text/javascript">
            $(function(){
                var swicherStates = {
                    on: "{{ "Collapse"|trans }}",
                    off: "{{ "Expand"|trans }}"
                }

                $(document).on("click", "a.i-switcher", function(e){
                    e.preventDefault();

                    var $target = $(e.target),
                        $container = $($target.data("target"));

                    if ($container.is(":visible")) {
                        $container.hide();
                        $target.text(swicherStates.off);
                    } else {
                        $container.show();
                        $target.text(swicherStates.on);
                    }
                });
            });
        </script>

        <script type="text/javascript" charset="utf-8">
            $(document).ready(function () {
                var bindAddForm = function (parent, name) {
                    $('a.add-form-' + name).click(function (e) {
                        var parentFormText = $('.form-content-' + name);
                        var deleteLink = $('<a>').addClass('btn btn-danger pull-right delete').attr('href', '#').html('{{ "Delete"|trans }}');
                        var clone = $(this).data('form-template');
                        var newForm = clone.replace(/__name__/g, parentFormText.length);
                        var newFormDiv = $('<div></div>').addClass('form-content-' + name).append(newForm);
                        newFormDiv.prepend(deleteLink);
                        $(parent).append(newFormDiv);
                        $(parent).append(this);
                        return false;
                    });
                    $(document).on('click', '.form-content-' + name + ' a.delete', function (e) {
                        $(this).parent().remove();
                        return false;
                    });
                }
                bindAddForm('#texts', 'text');
                bindAddForm('#urls', 'url');
                bindAddForm('#slideshares', 'slideshare');
                bindAddForm('#tasks', 'task');
            });
        </script>

    </div>
</div>